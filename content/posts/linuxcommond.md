+++
title = 'Linux实用命令手册'
date = 2024-01-19T11:34:54+08:00
draft = false
+++
## 前言
刚开始工作时，看到同事们娴熟地输入各种Linux命令，有些人一条命令可以轻松输入三四行，流畅自如，让我觉得非常神奇。可是当轮到我自己时，总是记不住这个命令、那个参数。向他人请教，他们总是说多敲几次就熟悉了，但我总是不知道何时才能有那个“多”的机会。因此，我翻阅了各种Linux书籍，甚至看了好几本，但似乎仍然无法掌握。于是，我开始反思，直到有一天豁然开朗，开始轻松驾驭各种命令。我认识到的核心关键是：不要将Linux命令看作系统化的知识，而是要像背单词一样学习。

为何这样说呢？我和许多初学者交流过，由于大家在学校主要学习编程语言，很容易将学习编程语言的思维方式带入到Linux命令学习中，努力理解各种语法糖，试图构建一个完整的编码体系。但实际上，编程语言对应的应该是Linux脚本编程，而对于Linux命令来说，我们无法像写代码那样进行调试。而且由于历史原因，许多Linux命令功能重叠，使得整个体系变得复杂而庞大。在这种情况下，我们应该找出其中最实用的命令，刻意背诵常用的，然后学会查阅Linux文档（特别是man文档的专用格式），遇到不常见的命令要有查阅的能力。因此，一份真正的一线实战Linux命令手册变得至关重要，我在这里进行了总结。

## 掌握灵活的Log提取技巧
由于现代监控系统和日志系统的存在，理论还是那个时候我们可以借由平台来查看日志和一些基本问题。但是日志平台通常不够灵活，所以常常需要我们手动提取一下日志来判断。那么问题来了日志格式有很多种，要怎么用一些常用的命令保证不论什么日志我们都可以快速提取我们想要的内容呢？  

我总结两大使用场景：
- 提取
- 查找

### 提取
根据我的经验，绝大多数的提取场景逃不过这7个命令的排列组合
1. wc
2. head
3. cut
4. grep
5. sort
6. uniq
7. awk

- wc  
  >1. -l 是行数  
  >2. -d 是字数 

- head  
    >1. head -n 就是前几行  
    >2. tail -n 是最后几行，和head相对应的
- cut 
   >1. cut -d ':' -f 2-  
   -d就是以什么作为分割，-f就是field,要显示哪些分割后的部分, 2-就是第二个后面都显示  
   >2. 特殊情况，制表符分割要用$:  
   cut -d $'\t'
- grep 
  >1. grep 过滤出关键词   
  >2. grep -v 不要这个关键词

- sort 部分排序
  > 1. sort -k5,5n  
   `-k 5,5`: 这部分指定了要排序的字段范围。在这个例子中，`2,2` 表示只考虑第二个字段，n代表看成数字  
  > 2. sort -S 500M --parallel=4 -T   
   --paraller是多线程，有时候文件太大了，可以用这个加速分割速度  
  >3. sort -t ',' -k2,2nr  
    -t的作用是分分隔符
- uniq 
  >1. sort| uniq -c
  统计相同行，通常用于查出ip之后统计高频的, 常常跟sort一起用

- awk  
  awk本来最复杂，但只要学几个简单用法就行。
  >1.  awk 提取列  
 awk '{print $1, $3}' logfile.log
  >2. 提取关键字error的行  
   awk '/error/ {print}' logfile.log
  >3. 分割符号提取: 这个分割比cut好用很多  
   awk -F ',' '{print $2, $4}' csvfile.csv 
  >4. 格式化输出  
    awk '{printf "Date: %s, Time: %s\n", $1, $2}' logfile.log   

### 查找
- grep 
  >grep -rni 关键字  
   这个最常用最简单, 功能就是在全文检索当前目录下面的所有包含这个关键字的文件
- tree 查看目录结构  
  >默认不装，需要安装一个
- find递归目录查文件  
  >  find /path/to/search -type f -name "filename"  
  这是最难记的一个，还好使用频率不高
  
基本这三个就够了，当然还有别的，但都很难记，没必要去搞。


## 快速排查硬件问题
### 磁盘
硬盘一般是两大场景
- 磁盘满了需要找大文件
> 1. df -h  
这个在/查一下哪个磁盘占用大
> 2. ncdu -x /path  
这个非常好用，扫描路径下的所有文件，统计出大小

- 磁盘找进程
> 1. iotop
  监控发现io读写很高，通过磁盘io查到是哪个进程
> 2. lsof
  知道了一个文件有问题，要看哪个进程在读写  

磁盘相关的问题其实非常多，但是本文只讲常用的。不常用的也挺重要，可以形成系统化认知，我将在另一篇文章中写写。

### 内存
常见的就是内存爆了
> top  
可以看到是哪个进程干爆了内存
### cpu
> top  
cpu通常不太会出问题。现在的服务器都是多核，单核被打满不会影响别的。

### 系统日志
> dmesg -T  
这个日志是从内核环形缓冲区中获得的。硬件相关的问题很多会记录在这里，常见比如cpu温度过高，网卡flapping，外接设备插拔等。

### 网络和网卡
> ifconfig  
  查看网络信息
> telnet  
  telnet {ip} {port}, 检查端口连接
> mtr  
  mtr -u -P {ip} --report 检查网络是否通  
网络和网卡的问题其实不容易排查，尤其是企业中网络情况往往很复杂，结合linux在下面来单独的说说

## Linux知识相关命令
这部分是涉及到linux系统的问题，都是非常常见的情况，如果不知道或者现场调试的时候忘了怎么写，会非常容易场面尴尬, 必须烂熟于心。

### linux文件权限
### linux文件软连接和硬连接
### linux环境变量
### linux网络基本
### linux网络高阶
